
# 도시건설 시뮬레이터 확장판 PRD (v2.0)
**프로젝트명**: Strategic City Simulator (가칭)  
**작성일**: 2025-08-10  
**버전**: 2.0 (확장판)

---

## 1. 제품 개요

### 1.1 배경 (Background)
심시티나 삼국지 같은 게임을 즐겨했지만, 너무나 세팅할 요소가 많아 시간이 오래 걸리고, 플레이어가 모든 세부 조정을 직접 해야 하는 점이 피로하게 느껴졌다.  
따라서 **내 의도를 간단하게 주입하고, 결과를 직관적으로 확인할 수 있는** 시뮬레이터가 필요했다.

### 1.2 목표 (Aim)
이 제품은 **엔터테인먼트용** 도시 발전 시뮬레이터다.  
쉽게 정책을 설정하고, 월 단위로 도시 변화와 발전을 확인하며 즐길 수 있도록 설계한다.

### 1.3 타겟 유저 (Target Users)
- **주요 대상**: 도시경영 게임 초보자
- 복잡한 메뉴 없이 간단히 플레이 가능
- 빠른 피드백과 직관적 결과 확인을 원하는 사용자

### 1.4 차별화 요소 (USP)
- **쉽다**: 복잡한 서브 메뉴와 세부 설정 없이 예산 비율만 결정해도 플레이 가능
- **간단한 보고서**: 월 단위 변화 요약
- **자동 상호작용 계산**: 세부 지표 간 영향 관계 자동 반영
- **빠른 플레이**: 1세션 15~20분 내 완료 가능

---

## 2. 주요 기능

### 2.1 게임 진행 흐름
1. **신규 게임 시작**
   - 난이도 선택(Easy, Normal, Hard)
   - 도시 초기 상태 설정(자동 또는 프리셋)
2. **월간 예산 책정**
   - 세수 + 외부 지원금 + 잔여금
3. **예산 배분**
   - 국방 / 외교 / 경제 / 정치 / 문화 / 환경 비율 결정
4. **시뮬레이션 실행**
   - 세부 지표 업데이트
   - 카테고리 점수 재계산
   - 이벤트 발생 및 영향 반영
5. **월간 보고서 출력**
   - 주요 변화 요약, 이벤트, 종합 도시 지수
6. **승리·패배 조건 확인**
   - 승리: 목표 지수 달성
   - 패배: 종합 지수 하락, 부채 초과 등

---

## 3. 지표 구조

### 3.1 세부 지표 (Low-Level Indicators)
| 카테고리 | 지표명 | 단위 | 초기값 | 최소/최대 | 자연 변화율 | 투자 효율 | 상호작용 |
|----------|-------|------|--------|-----------|-------------|-----------|----------|
| 국방 | 군사력 지수 | 점수 | 50 | 0~100 | -0.3 | 0.5 | 정치 안정도↑시 +0.1 |
| 국방 | 병력 규모 | 명 | 5000 | 0~∞ | -1% | 0.4 | 경제 지수↑시 유지비 상승 |
| 외교 | 국제 신뢰도 | 점수 | 60 | 0~100 | -0.2 | 0.3 | 문화↑시 +0.2 |
| 경제 | GDP | 억 원 | 1000 | 0~∞ | -0.5% | 0.4 | 정치 안정도↑시 +0.1 |
| 경제 | 실업률 | % | 6 | 0~100 | +0.05 | -0.3 | 산업 투자↑시 감소 |
| 정치 | 정치 안정도 | 점수 | 55 | 0~100 | -0.1 | 0.2 | 경제↑시 +0.1 |
| 문화 | 교육 수준 | 점수 | 50 | 0~100 | -0.05 | 0.3 | 정치 안정도↑시 +0.1 |
| 환경 | 대기질 | 점수 | 70 | 0~100 | -0.1 | 0.25 | 산업 투자↑시 -0.2 |

### 3.2 카테고리 지표 (Mid-Level Indicators)
- 각 카테고리별 세부 지표 가중 평균
- 예: 경제 = (GDP×0.4) + (실업률 역수×0.3) + (산업 성장률×0.3)

### 3.3 종합 도시 지수 (Top-Level Index)
- 카테고리별 가중 평균(경제 25%, 정치 20%, 국방 15%, 외교 15%, 문화 15%, 환경 10%)

---

## 4. 상호작용 매트릭스
| From\To | 국방 | 외교 | 경제 | 정치 | 문화 | 환경 |
|---------|------|------|------|------|------|------|
| 국방 | - | -2 | -1 | +1 | 0 | -1 |
| 외교 | -1 | - | +2 | +1 | +2 | 0 |
| 경제 | 0 | +1 | - | +2 | +1 | -2 |
| 정치 | +1 | +1 | +2 | - | +1 | 0 |
| 문화 | 0 | +2 | +1 | +1 | - | 0 |
| 환경 | -1 | 0 | -2 | 0 | 0 | - |

값 범위: -3(강한 부정 영향) ~ +3(강한 긍정 영향)

---

## 5. 이벤트 시스템

### 5.1 이벤트 유형
- 자연재해
- 국제정치
- 경제
- 사회
- 환경
- 기술혁신

### 5.2 이벤트 예시
| 이벤트명 | 유형 | 조건 | 발생 확률 | 영향 |
|----------|------|------|-----------|------|
| 태풍 피해 | 자연재해 | 환경 < 50 | 3% | 경제 -5, 인프라 -7, 행복도 -3 |
| 무역 협정 체결 | 외교 | 외교 > 60 | 4% | 경제 +5, 국제 신뢰도 +3 |
| 대규모 부패 스캔들 | 정치 | 정치 안정도 < 40 | 2% | 정치 안정도 -10, 국제 신뢰도 -5 |
| 신기술 개발 | 기술혁신 | 경제 > 70 | 1% | 경제 +8, 환경 +2 |

---

## 6. 난이도별 파라미터
| 난이도 | 초기 예산 | 세수 성장률 | 투자 효율 | 이벤트 빈도 |
|--------|-----------|-------------|-----------|-------------|
| Easy | 15억 | +3% | 1.2x | 5% |
| Normal | 10억 | +2% | 1.0x | 8% |
| Hard | 8억 | +1% | 0.8x | 12% |

---

## 7. 데이터 구조
### 7.1 주요 테이블
```
TABLE indicator_values (
  id SERIAL PRIMARY KEY,
  year INT,
  month INT,
  name VARCHAR(50),
  value FLOAT,
  category VARCHAR(20)
)

TABLE budget_allocations (
  id SERIAL PRIMARY KEY,
  year INT,
  month INT,
  category VARCHAR(20),
  amount FLOAT
)

TABLE events (
  id SERIAL PRIMARY KEY,
  year INT,
  month INT,
  event_type VARCHAR(20),
  description TEXT,
  impact JSON
)
```

---

## 8. UI/UX
- **예산 배분 화면**: 슬라이더/숫자 입력
- **월간 보고서 화면**: 표 + 변화 화살표 + 주요 이벤트
- **이벤트 알림**: 팝업 또는 로그

---

## 9. 밸런스 & 성능 요구사항
- 턴 계산 시간 < 200ms
- 저장 파일 크기 < 5MB
- 최대 1200턴(100년) 지원
- 재현 가능한 난수 시드

---

## 10. KPI
- 평균 플레이 시간: 20분 이상
- 월→월 턴 진행률: 80% 이상
- 게임 완료율: 60% 이상

---

## 11. 보강 사양(설계 가이드)

### 11.1 재정 모델(월간 흐름)
- 초기 예산(난이도): Easy 15억 / Normal 10억 / Hard 8억 → 세션 생성 시 `initialBudget`, `treasury`에 반영.
- 월간 세수: `revenue_t = floor(revenue_{t-1} × (1 + growthRate_difficulty))` (PRD §6 성장률 기반). 초기 `revenue_0`는 난이도별 기본 세수로 설정(추후 표 정의).
- 지출: `expense_t = monthlyBudget_t × ∑(ratio_k)`; 카테고리별 지출 = `monthlyBudget_t × ratio_k`.
- 잔액: `treasury_t = treasury_{t-1} + revenue_t + grants_t - expense_t`.
- 한도: 부채 허용 한도(예: -5억) 도달 시 경고/행동 제한(턴 진행 불가 또는 효율 페널티).

### 11.2 지표 계산/상호작용
- 자연 변화(`naturalDrift_k`), 투자 효율(`investmentEfficiency_k`), 상호작용 매트릭스(from→to, -3~+3).
- 스케일링: `interactionDelta_k = (∑_from ratio_from × weight_from→k) × interactionScale`.
- 기본 점수 업데이트: `next_k = clamp(current_k + natural_k + baseDelta×ratio_k×eff_k + interactionDelta_k, 0, 100)`.
- 튜닝 지침: interactionScale은 0.5~2.0 범위에서 벤치마킹(100턴 안정성 검증 포함).

### 11.3 이벤트 시스템 보강
- 난이도별 빈도 스케일: Easy 0.8x / Normal 1.0x / Hard 1.2x(예시). `effectiveProb = baseProb × freqScale_difficulty`.
- 조건 언어: `score(ECONOMY) > 70`, `month%12==0`, 합성식(AND/OR) 허용.
- 외부화: `events.json` 스키마(이름, 유형, 조건, 확률, 영향 맵). 로드시 스키마 검증 및 실패 시 기본 세트로 폴백.

### 11.4 데이터 스키마/버전 정책
- 세션: `game_sessions(initial_budget BIGINT, treasury BIGINT, difficulty, current_month, created_at ...)`.
- 월 스냅샷(선택): `finance_snapshots(session_id, year, month, revenue, expense, treasury)`로 리포트 속도 개선.
- 마이그레이션 원칙: 배포 후 마이그레이션은 수정 금지, 변경 필요 시 `V{n+1}__patch.sql` 추가. 개발 중에는 repair 허용(local/dev/tc).

### 11.5 API 계약(요약)
- `POST /api/v1/sessions` → { sessionId, difficulty, scores, initialBudget, treasury }.
- `POST /api/v1/sessions/{id}/simulate` → { before, after, delta, events, overallIndex, (추가 예정) financeDelta }.
- `GET /api/v1/sessions/{id}/reports?year=&month=` → { scores, overall, events, cumulativeByType, (추가) finance: { revenue, expense, treasury } }.
- (선택) `GET /api/v1/sessions/{id}` → 메타 복원용(difficulty, initialBudget, createdAt, currentMonth, treasury).

### 11.6 UX/플로우 디테일
- 랜딩: 새 게임 시작(NewGameDialog) / 기존 세션 ID 진입. ID 검증 실패 시 가이드 제공.
- 대시보드: 상단 바에 세션/난이도/초기 예산/현재 잔액. 슬라이더 변경 시 예상 변화(±범위) 미리보기.
- 접근성: 슬라이더 키보드 지원, 대비/포커스 스타일, 로딩/에러/빈 상태 표준화.

### 11.7 밸런싱/KPI/테스트
- 회귀: 고정 시드로 12개월 실행 스냅샷 비교(허용 오차 ±1~2pt). 재정·지표 동시 검증.
- 부하: 턴 계산 < 200ms(로컬 기준), 1.2k턴까지 누적 안정성.
- KPI 모니터링: 평균 플레이 20분, 월→월 진행률 80%+, 완료율 60%+. 밸런스 조정 시 A/B 시뮬 자동 리포트.
